<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Examples - ICOS Carbon Portal pylib</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Examples";
    var mkdocs_page_input_path = "examples.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ICOS Carbon Portal pylib</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">About</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="..#icos">ICOS</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../install/#pip-official-release">pip official release</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../install/#pip-latest-version">pip latest version</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../install/#dependencies">dependencies</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/">Modules</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../modules/#dobj">dobj</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjcitation">Dobj.citation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjcolnames">Dobj.colNames</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjdatetimeconvert-true">Dobj.dateTimeConvert = True</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjdobj-pid">Dobj.dobj = PID</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjget">Dobj.get()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjvalid">Dobj.valid</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjinfo">Dobj.info</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjlat">Dobj.lat</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjlon">Dobj.lon</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjelevation">Dobj.elevation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#dobjstation">Dobj.station</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../modules/#station">station</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationcountry">Station.country</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationdatalevelnone">Station.data(level=None)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationeag">Station.eag</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationeas">Station.eas</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationicosclass">Station.icosclass</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationfirstname">Station.firstName</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationlastname">Station.lastName</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationemail">Station.email</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationlat">Station.lat</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationlon">Station.lon</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationname">Station.name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationproject">Station.project</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationstationid">Station.stationId</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationtheme">Station.theme</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationuri">Station.uri</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#stationvalid">Station.valid</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#convenience-functions">Convenience functions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="../modules/#getidlist">.getIdList()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="../modules/#get">.get()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="../modules/#getlist">.getList()</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../modules/#sparql">sparql</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#runsparqldata">RunSparql.data</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#runsparqlquery-query">RunSparql.query = 'query'</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#runsparqlformat-fmt">RunSparql.format = 'fmt'</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#runsparqlformat-fmt_1">RunSparql.format = 'fmt'</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../modules/#runsparqlrun">RunSparql.run()</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Examples</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#digital-object">Digital Object</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#dataframe">DataFrame</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#minimalistic-plot">Minimalistic Plot</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#plot-with-title-and-units">Plot with Title and Units</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#stations">Stations</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#station-ids">Station Id's</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#a-station-object">A station Object</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#list-of-stations">List of Stations</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../faq/#nice-to-have">Nice to have</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../faq/#known-issues">Known issues</a>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ICOS Carbon Portal pylib</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Examples</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="examples">Examples</h1>
<h2 id="digital-object">Digital Object</h2>
<p>For the example below, we assume that you know how to get hold of 
the URI use at the Carbon Portal. You can read more about this in the Modules section. The following examples will use the URI <a href="https://meta.icos-cp.eu/objects/lNJPHqvsMuTAh-3DOvJejgYc">https://meta.icos-cp.eu/objects/lNJPHqvsMuTAh-3DOvJejgYc</a>: ICOS Atmosphere Level 2 data, Norunda, release 2019-1. Go to the landing page find more information.</p>
<hr>

<h3 id="dataframe">DataFrame</h3>
<pre><code>from icoscp.cpb.dobj import Dobj

dobj = Dobj('https://meta.icos-cp.eu/objects/lNJPHqvsMuTAh-3DOvJejgYc')
data = dobj.get()
data.head(10)
</code></pre>
<p>Printing the first 10 rows of the data (data.head(10)) should yield the following table:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>Flag</th>
<th>NbPoints</th>
<th>Stdev</th>
<th>TIMESTAMP</th>
<th>ch4</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>N</td>
<td>0</td>
<td>-9.990</td>
<td>2017-04-01 00:00:00</td>
<td>NaN</td>
</tr>
<tr>
<td>1</td>
<td>N</td>
<td>0</td>
<td>-9.990</td>
<td>2017-04-01 01:00:00</td>
<td>NaN</td>
</tr>
<tr>
<td>2</td>
<td>O</td>
<td>9</td>
<td>0.079</td>
<td>2017-04-01 02:00:00</td>
<td>1948.660034</td>
</tr>
<tr>
<td>3</td>
<td>O</td>
<td>16</td>
<td>1.070</td>
<td>2017-04-01 03:00:00</td>
<td>1950.900024</td>
</tr>
<tr>
<td>4</td>
<td>O</td>
<td>17</td>
<td>0.817</td>
<td>2017-04-01 04:00:00</td>
<td>1953.229980</td>
</tr>
<tr>
<td>5</td>
<td>O</td>
<td>16</td>
<td>0.271</td>
<td>2017-04-01 05:00:00</td>
<td>1956.319946</td>
</tr>
<tr>
<td>6</td>
<td>O</td>
<td>16</td>
<td>0.590</td>
<td>2017-04-01 06:00:00</td>
<td>1957.810059</td>
</tr>
<tr>
<td>7</td>
<td>O</td>
<td>16</td>
<td>0.736</td>
<td>2017-04-01 07:00:00</td>
<td>1960.550049</td>
</tr>
<tr>
<td>8</td>
<td>O</td>
<td>16</td>
<td>0.429</td>
<td>2017-04-01 08:00:00</td>
<td>1962.540039</td>
</tr>
<tr>
<td>9</td>
<td>O</td>
<td>17</td>
<td>0.861</td>
<td>2017-04-01 09:00:00</td>
<td>1965.349976</td>
</tr>
</tbody>
</table>
<hr>

<h3 id="minimalistic-plot">Minimalistic Plot</h3>
<p>This first example shows how to extract a data file and create a plot. It is the easiest way to load the data into a Pandas DataFrame in your Python environment. The DataFrame contains the following columNames:
Flag, NbPoints, Stdev, TIMESTAMP, ch4. Let's load the data and create a plot for measured methan concentrations over time.</p>
<pre><code>import matplotlib.pyplot as plt
from icoscp.cpb.dobj import Dobj

dobj = Dobj('https://meta.icos-cp.eu/objects/lNJPHqvsMuTAh-3DOvJejgYc')
data = dobj.get()
data.plot(x='TIMESTAMP', y='ch4', grid=True)

plt.show()
</code></pre>
<p><img alt="Result" src="../img/dobj_minimal.png" /></p>
<hr>

<h3 id="plot-with-title-and-units">Plot with Title and Units</h3>
<p>To get a useful plot, at least we should have a title and the unit of measurement is absolutely paramount:</p>
<pre><code>import matplotlib.pyplot as plt
from icoscp.cpb.dobj import Dobj

dobj = Dobj('https://meta.icos-cp.eu/objects/lNJPHqvsMuTAh-3DOvJejgYc')
data = dobj.get()

# extract information from the dobj meta data
# look at dobj.info() for a full list 
unit = dobj.info[1].unit[dobj.info[1]['colName'] =='ch4'].values[0]
title = dobj.info[0].specLabel[0]
title = dobj.info[2].stationName[0] + ' (' + dobj.info[2].stationId[0] + ')'
title = title + '\n'  + dobj.info[0].specLabel[0]

plot = data.plot(x='TIMESTAMP', y='ch4', grid=True, title=title)
plot.set(ylabel=unit)

plt.show()
</code></pre>
<p><img alt="Result" src="../img/dobj_title.png" /></p>
<h2 id="stations">Stations</h2>
<h3 id="station-ids">Station Id's</h3>
<p>The function to get the station id's might be something you will use a lot. Based on a station id you can get all the dobj id's (PID/URI) and hence access to the data. So if you have no idea whatsovever what stations are available, you came to the right place:</p>
<pre><code>from icoscp.station import station
stationList = station.getIdlist()  # returns a Pandas DataFrame
stationList.columns  # what information do we get back?
</code></pre>
<p>['uri', 'id', 'name', 'country', 'lat', 'lon', 'elevation', 'project','theme']</p>
<pre><code>stationList.head(5)
</code></pre>
<table>
<thead>
<tr>
<th>uri</th>
<th>id</th>
<th>name</th>
<th>...</th>
<th>project</th>
<th>theme</th>
</tr>
</thead>
<tbody>
<tr>
<td>...</td>
<td>SE-Sto</td>
<td>Abisko-Stordalen Palsa Bog</td>
<td>...</td>
<td>ICOS</td>
<td>ES</td>
</tr>
<tr>
<td>...</td>
<td>IT-Noe</td>
<td>Arca di Noe - Le Prigionette</td>
<td>...</td>
<td>ICOS</td>
<td>ES</td>
</tr>
<tr>
<td>...</td>
<td>UK-AMo</td>
<td>Auchencorth Moss</td>
<td>...</td>
<td>ICOS</td>
<td>ES</td>
</tr>
<tr>
<td>...</td>
<td>FR-Aur</td>
<td>Aurade</td>
<td>...</td>
<td>ICOS</td>
<td>ES</td>
</tr>
<tr>
<td>...</td>
<td>11BE</td>
<td>BE-SOOP-Belgica</td>
<td>...</td>
<td>ICOS</td>
<td>OS</td>
</tr>
</tbody>
</table>
<p><br>
Now you have basic information about a station, but most important you got the station id as well. NOTE: to create a station object you need to provide the station id as is <strong>CaseSensitiv</strong></p>
<h3 id="a-station-object">A station Object</h3>
<p>Let's create a station object and have a look what information is provided with the functin .info() . Each entry from "info" is an attribute and can be extracted with "myStation.attrib". In the following example you can access the station name with myStation.name</p>
<pre><code>from icoscp.station import station
myStation = station.get('IT-Noe')
myStation.info()
</code></pre>
<p>{
'stationId': 'SE-Nor',<br>
'name': 'Norunda',<br>
'theme': 'ES',<br>
'icosclass': '2',<br>
'siteType': 'Forest',<br>
'lat': 60.0865,<br>
'lon': 17.4795,<br>
'eas': None,<br>
'eag': '36',<br>
'firstName': 'Meelis',<br>
'lastName': 'MÃ¶lder',<br>
'email': 'meelis.molder@nateko.lu.se',<br>
'country': 'SE',<br>
'project': ['ICOS'],<br>
'uri': ['http://meta.icos-cp.eu/resources/stations/ES_SE-Nor']}<br></p>
<pre><code>myStation.products() # return DataFrame with all products available from this station
</code></pre>
<table>
<thead>
<tr>
<th>id</th>
<th>specification</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Drought 2018 Archive Product</td>
</tr>
<tr>
<td>1</td>
<td>Ecosystem meteo time series (ICOS Sweden)</td>
</tr>
<tr>
<td>2</td>
<td>Ecosystem fluxes time series (ICOS Sweden)</td>
</tr>
<tr>
<td>3</td>
<td>Ecosystem eco time series (ICOS Sweden)</td>
</tr>
<tr>
<td>4</td>
<td>Drought 2018 FLUXNET Product</td>
</tr>
<tr>
<td>5</td>
<td>ICOS ETC Archive Product</td>
</tr>
<tr>
<td>6</td>
<td>ICOS ETC FLUXNET Product</td>
</tr>
</tbody>
</table>
<p><br>
<br>
All the dobj URI's (ultimately containing the data itself) can be retrieved with "myStation.data()"
let see what columns are provided. The most important information will be the 'dobj' column. This contains the link to the data and can be used to extract the data.</p>
<pre><code>from icoscp.station import station
myStation = station.get('SE-Nor')
myStation.data().columns
</code></pre>
<p>['station', 'dobj', 'spec', 'timeStart', 'timeEnd', 'specLabel','samplingheight', 'datalevel', 'bytes']</p>
<pre><code>myStation.data(level='2') # return a DataFrame with Level 2 data objects for the station
</code></pre>
<table>
<thead>
<tr>
<th>station</th>
<th>dobj</th>
<th>spec</th>
</tr>
</thead>
<tbody>
<tr>
<td>...stations/ES_SE-Nor</td>
<td>https://meta.icos-cp.eu/objects/KfJjYyksI2nxCiJU36UfYVY_</td>
<td>.../dought2018ArchiveProduct</td>
</tr>
<tr>
<td>...stations/ES_SE-Nor</td>
<td>https://meta.icos-cp.eu/objects/L-in6TpOcGjmXruwi3ESD9G2</td>
<td>.../drought2018FluxnetProduct</td>
</tr>
<tr>
<td>...stations/ES_SE-Nor</td>
<td>https://meta.icos-cp.eu/objects/mBPKiB9tIQZQGrsy8ehAinvz</td>
<td>.../etcArchiveProduct</td>
</tr>
<tr>
<td>...stations/ES_SE-Nor</td>
<td>https://meta.icos-cp.eu/objects/XA_Ifq7BKqS0tkQd4dGVEFnM</td>
<td>.../etcFluxnetProduct</td>
</tr>
</tbody>
</table>
<p>This is not the full output, just an excerpt..... most important is the dobj column. You can use the content of the column 'dobj' to extract data. Now we put everything together</p>
<pre><code>from icoscp.cpb.dobj import Dobj
from icoscp.station import station
myStation = station.get('SE-Nor')
myDobj = Dobj(myStation.data().dobj[1]) # this would be the second record from above table (drought2018FluxnetProduct)
data = myDobj.get()
data.columns
</code></pre>
<p>['GPP_DT_VUT_REF', 'GPP_NT_VUT_REF', 'H_F_MDS', 'H_F_MDS_QC', 'LE_F_MDS','LE_F_MDS_QC', 'NEE_VUT_REF', 'NEE_VUT_REF_QC', 'RECO_DT_VUT_REF','RECO_NT_VUT_REF', 'SW_IN_F', 'SW_IN_F_QC', 'TA_F', 'TA_F_QC','TIMESTAMP', 'TIMESTAMP_END', 'VPD_F', 'VPD_F_QC']</p>
<h3 id="list-of-stations">List of Stations</h3>
<p>There is a built in function to extract a list of stations. Be aware that if you extract all ICOS stations, a lot of information is gathered and retrieved. At the time of writing there are over a 100 stations and in can take up to a minute to extract all.</p>
<pre><code>from icoscp.station import station
icosStations = station.getList()

for s in icosStations:
    print(s.stationId, s.name, s.lat, s.lon)
</code></pre>
<p>SE-Sto Abisko-Stordalen Palsa Bog 68.35596 19.04521 <br>
IT-Noe Arca di Noe - Le Prigionette 40.60617 8.15117 <br>
UK-AMo Auchencorth Moss 55.7925 -3.24362 <br>
FR-Aur Aurade 43.54965 1.106103 <br>
...</p>
<p><hr>cd20200715</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../faq/" class="btn btn-neutral float-right" title="FAQ">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../modules/" class="btn btn-neutral" title="Modules"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../modules/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../faq/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
